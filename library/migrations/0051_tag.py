# Generated by Django 3.1.1 on 2020-11-13 09:58

from django.db import migrations, models


def migrate_forwards(apps, schema_editor):
    Book = apps.get_model("library", "Book")
    Tag = apps.get_model("library", "Tag")

    for book in Book.objects.all():
        for tag in book.tags:
            new_tag, created = Tag.objects.get_or_create(name=tag)
            if created:
                print(f"created {tag} for {book.title}")


class Migration(migrations.Migration):

    dependencies = [
        ("library", "0050_auto_20200908_1506"),
    ]

    operations = [
        migrations.CreateModel(
            name="Tag",
            fields=[
                (
                    "name",
                    models.CharField(max_length=64, primary_key=True, serialize=False),
                ),
                (
                    "parents",
                    models.ManyToManyField(
                        blank=True,
                        symmetrical=False,
                        related_name="children",
                        to="library.Tag",
                    ),
                ),
            ],
        ),
        migrations.AlterModelOptions(
            name="tag",
            options={"ordering": ("name",)},
        ),
        migrations.RunPython(migrate_forwards, lambda a, b: None),
    ]
