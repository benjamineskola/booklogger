# Generated by Django 4.0.4 on 2022-06-03 15:54

from django.db import migrations, models


def set_tags(apps, *schema_editor):
    Book = apps.get_model("library", "Book")
    Tag = apps.get_model("library", "Tag")

    for book in Book.objects.all():
        book.tags.set(
            (Tag.objects.get_or_create(name=tag.lower())[0] for tag in book.tags_list)
        )
        book.save()


def unset_tags(apps, *schema_editor):
    Book = apps.get_model("library", "Book")

    for book in Book.objects.all():
        book.tags_list = [tag.name for tag in book.tags.all()]
        book.save()


class Migration(migrations.Migration):
    dependencies = [
        ("library", "0069_remove_book_library_boo_tags_a978d9_gin_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="book",
            name="tags",
            field=models.ManyToManyField(related_name="books", to="library.tag"),
        ),
        migrations.RunPython(set_tags, unset_tags),
        # migrations.RemoveIndex(
        # model_name="book",
        # name="library_boo_tags_li_254e32_gin",
        # ),
        # migrations.RemoveField(
        # model_name="book",
        # name="tags_list",
        # ),
    ]
