{% extends "base.html" %}
{% block content %}
<p class="ui basic segment">In total I own {{ owned }} books and have read {{ owned_read }} ({{ owned_read_pct | round(2) }}%) of them. I <a href="{{ url("library:books_unread") }}">want to read</a> {{ want_to_read }} ({{ want_to_read_pct | round(2) }}%) of them, including <a href="{{ url("library:books_unread") }}?read=true&owned=true">rereading</a> {{ reread }} ({{ reread_pct | round(2) }}%) of them.</p>

{% for year in books_by_year.keys() | sort | reverse %}
  {% if books_by_year[year]['count'] %}
  {% set year_books = books_by_year[year] %}

  {% if year == "total" %}
  {% set url_base = url("library:books_read") %}
  {% else %}
  {% set url_base = url("library:books_read", kwargs={"year": year}) %}
  {% endif %}
    <hr class="ui divider" />
    <div class="ui basic segment">
      <p>
        {% if year == "1" %}
          <a href="{{ url_base }}">Sometime</a>
        {% else %}
          In <a href="{{ url_base }}">{{ year | trim("!") }}</a>
        {% endif %}
        I read {% if year != "total" and year < "2014" %} at least {% endif %}{{ year_books["count"] }} books: {{ year_books["men"] }} by <a href="{{ url_base }}?gender=male">men</a> and {{ year_books["women"] }} by <a href="{{ url_base }}?gender=female">women</a>.
        {% if year_books["both"] or year_books["neither"] %} (
        {%- if year_books["both"] -%}
        {{ year_books["both"] }} of those were by both men and women
        {%- endif -%}
        {%- if year_books["both"] and year_books["neither"] %}; {% endif -%}
        {%- if year_books["neither"] -%}
        {{ year_books["neither"] }} were by <a href="{{ url_base }}?gender=organization">groups or organizations</a>.
        {%- endif -%}
        ){% endif %}
        <br>That's {% if year == current_year | string %}{{ (year_books["count"] / current_week) | round(1) }}{% else %}{{ (year_books["count"] / 52) | round(1) }}{% endif %} per week.
        {% if year == current_year | string %}(It's currently week {{ current_week }}.) On track to read {{ predicted_count | round(0, 'floor') | int }} this year.{% endif %}
      </p>
      <p>
        {{ year_books["fiction"] }} were <a href="{{ url_base }}?tags=fiction">fiction</a>,
        {{ year_books["nonfiction"] }} were <a href="{{ url_base }}?tags=non-fiction">non-fiction</a>.<br>

        {% for gender, n in [("men", 1), ("women", 2)] %}
        By {{ gender }}: {{ year_books["breakdowns"][gender]["fiction_count"] }} ({{ year_books["breakdowns"][gender]["percentage_fiction"] | round(2)}}%) <a href="{{ url_base}}?tags=fiction&gender={{n}}">fiction</a>, 
                         {{ year_books["breakdowns"][gender]["nonfiction_count"] }} ({{ year_books["breakdowns"][gender]["percentage_nonfiction"] | round(2)}}%) <a href="{{ url_base}}?tags=fiction&gender={{n}}">non-fiction</a>.<br>
        {% endfor %}

        {% for genre in ["fiction", "non-fiction"] %}
        {{ genre.title() }}: {{ year_books["breakdowns"][genre]["women_count"] }} ({{ year_books["breakdowns"][genre]["percentage_women"] | round(2) }}%) by <a href="{{ url_base}}?tags={{ genre }}&gender=2">women</a>, 
                             {{ year_books["breakdowns"][genre]["men_count"] }} ({{ year_books["breakdowns"][genre]["percentage_men"] | round(2) }}%) by <a href="{{ url_base}}?tags={{ genre }}&gender=1">men</a>.<br>
        {% endfor %}
      </p>
      {% if year_books["acquired"] %}<p>
      I acquired {{ year_books["acquired"] }} more books this year.
      That's {{ (year_books["count"] - year_books["acquired"]) | abs }} {% if year_books["acquired"] - year_books["count"] >= 0 %}more{% else %}fewer{% endif %} than I read.
      </p>{% endif %}
    </div>
  {% endif %}
{% endfor %}
{% endblock %}
