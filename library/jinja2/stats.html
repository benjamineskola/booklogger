{% extends "base.html" %}
{% block content %}
<p>In total I own {{ owned | count }} books.</p>
<p>Overall I've read {{ read | count }} in the period I've been tracking: {{ read.filter(first_author__gender=1) | count }} by men and {{ read.filter(first_author__gender=2) | count }} by women ({{ read.exclude(first_author__gender=1).exclude(first_author__gender=2).count() }} by groups or organizations).<p>
<p>
  {{ read.fiction() | count }} were fiction,
  {{ read.nonfiction() | count }} were non-fiction.<br>
  {{ read.by_men().fiction() | count }} books by men were fiction,
  {{ read.by_men().nonfiction() | count }} were non-fiction.<br>
  {{ read.by_women().fiction() | count }} books by women were fiction,
  {{ read.by_women().nonfiction() | count }} were non-fiction.
</p>

<ul>
{% for year in range(2004,2021) | reverse %}
  {% set year_books = books.filter(log_entries__end_date__year=year) %}
  {% if year_books | count > 0 %}
  {% set year_male = year_books.by_men().all() %}
  {% set year_female = year_books.by_women().all() %}
  {% set year_both = year_books.by_women().by_men().all() %}
  {% set year_neither = year_books.exclude(first_author__gender=1).exclude(first_author__gender=2).all() %}
    <li>
      <p>
        In <a href="{{ url("library:books_read", args=[year]) }}">{{ year }}</a> I read {{ year_books | count }} books: {{ year_male | count }} by <a href="{{ url("library:books_read", args=[year]) }}?gender=male">men</a> and {{ year_female | count }} by <a href="{{ url("library:books_read", args=[year]) }}?gender=female">women</a>.
        {% if year_both | count > 0 or year_neither | count > 0 %} (
        {%- if year_both |count > 0 -%}
        {{ year_both | count }} of those were by both men and women
        {%- endif -%}
        {%- if year_both | count > 0 and year_neither | count > 0 %}; {% endif -%}
        {%- if year_neither |count > 0 -%}
        {{ year_neither | count }} were by <a href="{{ url("library:books_read", args=[year]) }}?gender=organization">groups or organizations</a>.
        {%- endif -%}
        ){% endif %}
        <br>That's {% if current_year == year %}{{ (year_books | count / current_week) | round(1) }}{% else %}{{ (year_books | count / 52) | round(1) }}{% endif %} per week.
        {% if current_year == year %}(It's currently week {{ current_week }}.) On track to read {{ predicted_books | round(0, 'floor') | int }} this year.{% endif %}
      </p>
      <p>
        {{ year_books.fiction() | count }} were <a href="{{ url("library:books_read", args=[year]) }}?tags=fiction">fiction</a>,
        {{ year_books.nonfiction() | count }} were <a href="{{ url("library:books_read", args=[year]) }}?tags=non-fiction">non-fiction</a>.<br>
        By men: {{ year_male.fiction() | count }} ({{ ((year_male.fiction() | count) / (year_male | count | default(1, true)) * 100) | round(2) }}%) fiction, {{ year_male.nonfiction() | count }} ({{ ((year_male.nonfiction() | count) / (year_male | count | default(1, true)) * 100) | round(2) }}%) non-fiction.<br>
        By women: {{ year_female.fiction() | count }} ({{ ((year_female.fiction() | count) / (year_female | count | default(1, true)) * 100) | round(2) }}%) fiction, {{ year_female.nonfiction() | count }} ({{ ((year_female.nonfiction() | count) / (year_female | count | default(1, true)) * 100) | round(2) }}%) non-fiction.<br>
        Fiction: {{ year_male.fiction() | count }} ({{ ((year_male.fiction() | count) / (year_books.fiction() | count | default(1, true)) * 100) | round(2) }}%) by men, {{ year_female.fiction() | count }} ({{ ((year_female.fiction() | count) / (year_books.fiction() | count | default(1, true)) * 100) | round(2) }}%) by women.<br>
        Non-fiction: {{ year_male.nonfiction() | count }} ({{ ((year_male.nonfiction() | count) / (year_books.nonfiction() | count | default(1, true)) * 100) | round(2) }}%) by men, {{ year_female.nonfiction() | count }} ({{ ((year_female.nonfiction() | count) / (year_books.nonfiction() | count | default(1, true)) * 100) | round(2) }}%) by women.<br>
      </p>
    </li>
  {% endif %}
{% endfor %}
  {% set undated_read = read.exclude(log_entries__isnull=False) %}
  <li>
    <p>Plus {{ undated_read | count }} others (i.e., read, but I'm not sure when). {{ undated_read.by_men() | count }} by men and {{ undated_read.by_women() | count }} by women.</p>
      <p>
        {{ undated_read.fiction() | count }} were fiction,
        {{ undated_read.nonfiction() | count }} were non-fiction.<br>
        {{ undated_read.by_men().fiction() | count }} books by men were fiction,
        {{ undated_read.by_men().nonfiction() | count }} books by men were non-fiction.<br>
        {{ undated_read.by_women().fiction() | count }} books by women were fiction,
        {{ undated_read.by_women().nonfiction() | count }} books by women were non-fiction.
      </p>
  </li>
</ul>
{% endblock %}
