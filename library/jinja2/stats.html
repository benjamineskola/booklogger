{% extends "base.html" %}
{% block content %}
  <p class="ui basic segment">
    In total I own {{ owned }} books and have read {{ owned_read }} ({{ owned_read_pct | round_trunc(2) }}%) of them. I <a href="{{ url("library:books_unread") }}">want to read</a> {{ want_to_read }} ({{ want_to_read_pct | round_trunc(2) }}%) of them, including <a href="{{ url("library:books_unread") }}?read=true&owned=true">rereading</a> {{ reread }} ({{ reread_pct | round_trunc(2) }}%) of them.
  </p>

  {% for year in books_by_year.keys() | sort | reverse %}
    {% if books_by_year[year]['count'] %}
      {% set year_books = books_by_year[year] %}

      {% if year == "total" %}
        {% set url_base = url("library:books_read") %}
      {% else %}
        {% set url_base = url("library:books_read", kwargs={"year": ("sometime" if year == '1' else year)}) %}
      {% endif %}
      <hr class="ui divider" />
      <div class="ui basic segment">
        <p>
          {% if year == "1" %}
            <a href="{{ url_base }}">Sometime</a>
          {% else %}
            In <a href="{{ url_base }}">{{ year | trim("!") }}</a>
          {% endif %}
          I read {% if year != "total" and year < "2014" %} at least {% endif %}
          {{ year_books["count"] }} books: {{ year_books["men"] }} ({{ year_books['men_percent'] | round_trunc(2) }}%) by <a href="{{ url_base }}?gender=male">men</a> and {{ year_books["women"] }} ({{ year_books['women_percent'] | round_trunc(2) }}%) by <a href="{{ url_base }}?gender=female">women</a>.
          {% if year_books["nonbinary"] %}
            There were also {{ year_books["nonbinary"] }} ({{ year_books['nonbinary_percent'] | round_trunc(2) }}%) by <a href="{{ url_base }}?gender=nonbinary">nonbinary people</a>.
          {% endif %}
          {% if year_books["both"] or year_books["organisations"] %}
            (
            {%- if year_books["both"] -%}
              {{ year_books["both"] }} ({{ year_books['both_percent'] | round_trunc(2) }}%) of those were by multiple authors of different genders
            {%- endif -%}
            {%- if year_books["both"] and year_books["organisations"] %}; {% endif -%}
            {%- if year_books["organisations"] -%}
              {{ year_books["organisations"] }} ({{ year_books['organisations_percent'] | round_trunc(2) }}%) were by <a href="{{ url_base }}?gender=organization">groups or organizations</a>
            {%- endif -%}
            .)
          {% endif %}
          {% if year != "1" and year != "total" %}
            <br>That's {% if year == current_year | string %}{{ (year_books["count"] / current_week) | round_trunc(1) }}{% else %}{{ (year_books["count"] / 52) | round_trunc(1) }}{% endif %} per week.
          {% endif %}
          {% if year == current_year | string %}
            (It's currently week {{ current_week }}.) On track to read {{ predicted_count | round(0, 'floor') | int }} this year.
            {% if target_counts %}
              <br>
              {% for target, target_count in target_counts.items() %}
                To reach {{ target }} books I'd have to read {{ target_count | round_trunc(1) }} per week.
              {% endfor %}
            {% endif %}
          {% endif %}
          <br>
          There was a total pagecount of {{ year_books['pages'] }}: {{ year_books['men_pages'] }} ({{ year_books['men_pages_percent'] | round_trunc(2) }}%) by men, and {{ year_books['women_pages'] }} ({{ year_books['women_pages_percent'] | round_trunc(2) }}%) by women.
          {% if year_books["nonbinary"] %}
            There were also {{ year_books["nonbinary_pages"] }} ({{ year_books["nonbinary_pages_percent"] | round_trunc(2) }}%) by nonbinary people.
          {% endif %}
          {{ year_books['fiction_pages'] }} ({{ year_books['fiction_pages_percent'] | round_trunc(2) }}%) were fiction;
          {{ year_books['nonfiction_pages'] }} ({{ year_books['nonfiction_pages_percent'] | round_trunc(2) }}%) were non-fiction.
        </p>
        <p>
          {{ year_books["fiction"] }} were <a href="{{ url_base }}?tags=fiction">fiction</a>,
          {{ year_books["nonfiction"] }} were <a href="{{ url_base }}?tags=non-fiction">non-fiction</a>.<br>

          {% for gender, n in [("men", 1), ("women", 2)] %}
            By {{ gender }}:
            {{ year_books["breakdowns"][gender]["fiction_count"] }} ({{ year_books["breakdowns"][gender]["percentage_fiction"] | round_trunc(2) }}%) <a href="{{ url_base }}?tags=fiction&gender={{ n }}">fiction</a>,
            {{ year_books["breakdowns"][gender]["nonfiction_count"] }} ({{ year_books["breakdowns"][gender]["percentage_nonfiction"] | round_trunc(2) }}%) <a href="{{ url_base }}?tags=fiction&gender={{ n }}">non-fiction</a>.<br>
          {% endfor %}

          {% for genre in ["fiction", "non-fiction"] %}
            {{ genre.title() }}:
            {{ year_books["breakdowns"][genre]["women_count"] }} ({{ year_books["breakdowns"][genre]["percentage_women"] | round_trunc(2) }}%) by <a href="{{ url_base }}?tags={{ genre }}&gender=2">women</a>,
            {{ year_books["breakdowns"][genre]["men_count"] }} ({{ year_books["breakdowns"][genre]["percentage_men"] | round_trunc(2) }}%) by <a href="{{ url_base }}?tags={{ genre }}&gender=1">men</a>.<br>
          {% endfor %}
        </p>
        <p>
          I read {{ year_books["poc"] }} ({{ year_books['poc_percentage'] | round_trunc(2) }}%) books by <a href="{{ url_base }}?poc=1">POC</a>
          {%- if year_books["poc"] -%}
            ; that's {{ year_books['poc_pages'] }} pages, {{ year_books['poc_pages_percent'] | round_trunc(2) }}% of the total
          {%- endif -%}.
        </p>
        {% if year_books["acquired"] %}
          <p>
            I acquired {{ year_books["acquired"] }} more books this year.
            That's {{ (year_books["count"] - year_books["acquired"]) | abs }} {% if year_books["acquired"] - year_books["count"] >= 0 %}more{% else %}fewer{% endif %} than I read.
          </p>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
{% endblock %}
