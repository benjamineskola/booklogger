{% extends "base.html" %}
{% block header %}
{{ form.media.css }}

<link href="{{ static("select2-bootstrap4.min.css") }}" type="text/css" media="screen" rel="stylesheet">
{% endblock header %}
{% block content %}

{% if form.instance.id %}
<div class="card mb-3">
  <div class="card-body">
  <strong>Goodreads</strong> <a href="{{ form.instance.goodreads_url[0] }}">{{ form.instance.goodreads_url[1] }}</a></br>
  <strong>Amazon</strong> {% set j = joiner(' or ') %}{% for i in form.instance.amazon_urls %}{{ j() }}<a href="{{ i[0] }}">{{ i[1] }}</a>{% endfor %}</br>
  <strong>Google</strong> {% set j = joiner(' or ') %}{% for i in form.instance.google_urls %}{{ j() }}<a href="{{ i[0] }}">{{ i[1] }}</a>{% endfor %}
  </div>
</div>
{% endif %}

<form method="post">
  <div class="row row-cols-1 row-cols-md-2">
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

    {% for field_names in [
      ['title', 'subtitle', 'first_author', 'first_author_role', 'first_published', 'language', 'series', 'series_order', 'slug'],
      ['edition_title', 'edition_subtitle', 'publisher', 'edition_published', 'edition_format', 'edition_language', 'edition_number', 'page_count'],
      ['owned_by', 'acquired_date', 'alienated_date', 'was_borrowed', 'borrowed_from', 'want_to_read'],
      ['goodreads_id', 'google_books_id', 'isbn', 'asin', 'image_url', 'publisher_url'],
      ['has_ebook_edition', 'ebook_acquired_date', 'ebook_isbn', 'ebook_asin'],
      ['tags', 'review', 'rating'],
      ['editions', 'parent_edition'],
    ] %}
    {% if 'editions' not in field_names or ('editions' in form.fields or 'parent_edition' in form.fields) %}
      <div class="col">
        <div class="card mb-3">
          <div class="card-body">
            {% for field_name in field_names %}
              {% set field = form[field_name] %}
              {% if field %}
                {% include "edit_form_field_snippet.html" %}
              {% endif %}
            {% endfor %}
          </div> {# card-body#}
        </div> {# card #}
      </div> {# col#}
    {% endif %}
  {% endfor %}
  </div> {# row #}

  {% if inline_formset %}
  <div class="card mb-3">
    <div class="card-body">
      {{ inline_formset.management_form }}
      {% for form in inline_formset %}
      <div class="form-group">
        {{ form.id }}
        {% set field = form['author'] %}
        {% include "edit_form_field_snippet.html" %}
        <div class="form-row">
          {% for field in form %}
          {% if field.name not in ["id", "book", "author"] %}
            {% include "edit_form_field_snippet.html" %}
          {% endif %}
        {% endfor %}
        </div> {# form-row #}
      </div> {# form-group #}
      {% endfor %}
    </div> {# card-body #}
  </div> {# card #}
  {% endif %}

  <div class="form-group">
    <input type="submit" value="Submit" class="btn btn-primary">
    {% if form.instance.id %}
    <a href="{{ form.instance.get_absolute_url() }}" class="btn btn-secondary" role="button">Cancel</a>
    <a href="{{ url("admin:library_book_delete", args=[form.instance.id]) }}" class="btn btn-danger" role="button">Delete</a>
    {% else %}
    <a href="/" class="btn btn-secondary">Cancel</a>
    {% endif %}
  </div>
</form>

{% if form.instance.id %}
<a href="{{ url("admin:library_book_change", args=[form.instance.id]) }}">Advanced</a>
{% endif %}

{% endblock content %}
{% block footer %}
{{ form.media.js }}
<script>
$(document).ready(function() {
  $('.django-select2').djangoSelect2({
    'theme': 'bootstrap4'
  })
})
</script>
{% endblock footer %}
