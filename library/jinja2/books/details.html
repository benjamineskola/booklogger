{% extends "base.html" %}
{% block content %}
<div class="row row-cols-1 row-cols-md-2 mt-4">
  <div class="col">
{% include "books/card.html" %}
  </div>

  <div class="col">
    <dl>
    {% if book.authors | count > 3 or book.authors != book.all_authors %}
    <dt>Full Authors</dt><dd>
    {{ book.all_authors | map('get_hyperlink', book=book) | list | oxford_comma }}
    {% endif %}
    {% if book.subtitle %}
    <dt>Subtitle</dt><dd>{{ book.subtitle }}</dd>
    {% endif %}
    {% if book.edition_title %}
    <dt>Original Title</dt><dd>{{ book.title }}</br>
    {% endif %}
    <dt>First Published</dt><dd>{{ book.first_published }}</dd>
    {% if book.first_published != book.edition_published %}
    <dt>Edition Published</dt><dd>{{ book.edition_published }}</dd>
    {% endif %}

    <dt>Publisher</dt>
    {% if book.publisher_url %}
    <dd><a href="{{ book.publisher_url }}">{{ book.publisher or book.publisher_url }}</a></dd>
    {% else %}
    <dd>{{ book.publisher }}</dd>
    {% endif %}

    <dt>Format</dt><dd>{{ book.get_edition_format_display() }}</dd>
    {% if book.edition_number %}
    <dt>Edition</dt><dd>{{ book.edition_number }}</dd>
    {% endif %}
    <dt>Pages</dt><dd>{{ book.page_count }}</dd>

    {% if book.edition_language and book.language != book.edition_language %}
    <dt>Language</dt><dd>{{ book.get_edition_language_display() }}</dd>
    <dt>Original language</dt><dd>{{ book.get_language_display() }}</dd>
    {% else %}
    <dt>Language</dt><dd>{{ book.get_language_display() }}</dd>
    {% endif %}
  </div>

  <div class="col">
    {% if book.goodreads_id %}
    <dt>Goodreads</dt><dd><a href="https://goodreads.com/book/show/{{ book.goodreads_id }}">{{ book.goodreads_id }}</a></dd>
    {% elif book.isbn %}
    <dt>Goodreads</dt><dd><a href="https://www.goodreads.com/search?q={{ book.isbn }}">{{ book.isbn }}</a></dd>
    {% elif book.asin %}
    <dt>Goodreads</dt><dd><a href="https://www.goodreads.com/search?q={{ book.asin }}">{{ book.asin }}</a></dd>
    {% endif %}

    {% if book.google_books_id %}
    <dt>Google</dt><dd><a href="https://books.google.co.uk/books?id={{ book.google_books_id }}">{{ book.google_books_id }}</a></dd>
    {% elif book.isbn %}
    <dt>Google</dt><dd><a href="https://www.googleapis.com/books/v1/volumes?q=isbn:{{ book.isbn }}">{{ book.isbn }}</a></dd>
    {% else %}
    <dt>Google</dt><dd><a href="https://www.googleapis.com/books/v1/volumes?q={{ book.title | urlencode }}%20{{ book.first_author | urlencode }}">search</a></dd>
    {% endif %}

    {% if book.asin %}
    <dt>Amazon</dt><dd><a href="https://amazon.co.uk/dp/{{ book.asin }}">{{ book.asin }}</a></dd>
    {% elif book.isbn10 %}
    <dt>Amazon</dt><dd><a href="https://amazon.co.uk/dp/{{ book.isbn10 }}">{{ book.isbn10 }}</a>
    or
    <a href="https://www.amazon.co.uk/s?k={{ book.title | urlencode }}%20{{ book.first_author | urlencode }}&i=stripbooks">search</a></dd>
    {% endif %}
    <dt>ISBN</dt><dd>{{ book.isbn }}</dd>

    {% if book.has_ebook_edition %}
      <dt>Ebook Edition</dt><dd>{{ book.ebook_acquired_date }}</dd>
      {% if book.ebook_asin %}
      <dt>Amazon</dt><dd><a href="https://amazon.co.uk/dp/{{ book.asin }}">{{ book.asin }}</a></dd>
      {% endif %}
      {% if book.ebook_asin %}
      <dt>Ebook ISBN</dt><dd>{{ book.ebook_isbn }}</dd>
      {% endif %}
    {% endif %}
  </div>

  <div class="col">
    <dt>Owned</dt><dd>{{ book.owned }}</dd>
    <dt>Acquired</dt><dd>{{ book.acquired_date }}</dd>
    <dt>Sold/Donated</dt><dd>{{ book.alienated_date }}</dd>
    {% if book.borrowed %}
    <dt>Borrowed From</dt><dd>{{ book.borrowed_from }}</dd>
    {% endif %}
    </dl>
  </div>

  {% if book.review %}
  <div class="col">
    <h3>Review</h3>
    {{ book.review | markdown }}
  </div>
  {% endif %}

  <div class="col">
  <h3>Reading History</h3>
  <ul class="list-unstyled">
  {% for entry in book.all_log_entries %}
    <li>{% include "logentries/date_snippet.html" %}
    {% if entry not in book.log_entries.all() %}
    (<a href="{{ url('library:book_details', args=[entry.book.pk]) }}">{{ entry.book.get_edition_format_display().lower() }} edition</a>)
    {% endif %}
    <li>
  {% else %}
  <li>No reading history</li>
  {% endfor %}
  </ul>
  </div>

  <div class="col">
    {% include "books/update_form_snippet.html" %}
  </div>

  {% if book.editions.all() | count > 0 %}
  <div class="col">
    <h3>Other Editions</h3>
    <ul>
    {% for edition in book.editions.all() %}
    <li>{{ edition | get_hyperlink }} ({{ edition.get_edition_format_display() }} edition)</li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}
</div>
{% endblock content %}
