{% extends "base.html" %}
{% block content %}
<div class="row row-cols-1 row-cols-md-2 mt-4">
  <div class="col">
{% include "books/card.html" %}
  </div>

  <div class="col">
    <dl>
    {% if book.has_full_authors %}
    <dt>Full Authors</dt><dd>
    {{ book.all_authors | map('get_hyperlink', book=book) | list | oxford_comma }}
    {% endif %}
    </dd>

    <p>
    {% if book.edition_title or (book.edition_language and book.language != book.edition_language) or (book.first_published != book.edition_published) %}
      Originally published
    {% else %}
      Published
    {% endif %}

    {% if book.edition_title or (book.edition_language and book.language != book.edition_language) %}
      {% if book.edition_language and book.language != book.edition_language %}
        in {{ book.get_language_display() }}
      {% endif %}
      as <em>{{ book.title }}
      {%- if book.subtitle -%}
        : {{ book.subtitle }}
      {%- endif -%}
      </em>
    {% endif %}
    in {{ book.first_published }}.
    This
    {% if book.edition_format %}
      {{ book.get_edition_format_display().lower() }}
    {% endif %}
    {% if book.edition_number %}
      {{ book.edition_number | ordinal }}
    {% endif %}
    {% if book.language != book.edition_language %}
      {{ book.get_edition_language_display() }}
    {% endif %}
    edition published
    {% if book.edition_published and book.edition_published != book.first_published %}
      in {{ book.edition_published }}
    {% endif %}
    by
    {% if book.publisher_url %}
      <a href="{{ book.publisher_url }}">{{ book.publisher or book.publisher_url }}</a>
    {%- else -%}
      {{ book.publisher }}
    {%- endif -%}.
    {% if book.page_count %}
      {{ book.page_count | int }}pp.
    {% endif %}
    </p>
  </div>

  <div class="col">
    {% if book.goodreads_id %}
    <dt>Goodreads</dt><dd><a href="https://goodreads.com/book/show/{{ book.goodreads_id }}">{{ book.goodreads_id }}</a></dd>
    {% elif book.isbn %}
    <dt>Goodreads</dt><dd><a href="https://www.goodreads.com/search?q={{ book.isbn }}">{{ book.isbn }}</a></dd>
    {% elif book.asin %}
    <dt>Goodreads</dt><dd><a href="https://www.goodreads.com/search?q={{ book.asin }}">{{ book.asin }}</a></dd>
    {% endif %}

    {% if book.google_books_id %}
    <dt>Google</dt><dd><a href="https://books.google.co.uk/books?id={{ book.google_books_id }}">{{ book.google_books_id }}</a></dd>
    {% elif book.isbn %}
    <dt>Google</dt><dd><a href="https://www.googleapis.com/books/v1/volumes?q=isbn:{{ book.isbn }}">{{ book.isbn }}</a></dd>
    {% else %}
    <dt>Google</dt><dd><a href="https://www.googleapis.com/books/v1/volumes?q={{ book.title | urlencode }}%20{{ book.first_author | urlencode }}">search</a></dd>
    {% endif %}

    <dt>Amazon</dt><dd>
    {% if book.asin %}
    <a href="https://amazon.co.uk/dp/{{ book.asin }}">{{ book.asin }}</a></dd>
    {% elif book.isbn10 %}
    <dd><a href="https://amazon.co.uk/dp/{{ book.isbn10 }}">{{ book.isbn10 }}</a>
    or
    {% endif %}
    {% if not book.asin %}
    <a href="https://www.amazon.co.uk/s?k={{ book.title | urlencode }}%20{{ book.first_author | urlencode }}&i=stripbooks">search</a>
    {% endif %}
    </dd>
    <dt>ISBN</dt><dd>{{ book.isbn }}</dd>

    {% if book.has_ebook_edition %}
      <dt>Ebook Acquired</dt><dd>{{ book.ebook_acquired_date or "Unknown" }}</dd>
      {% if book.ebook_asin %}
      <dt>Amazon</dt><dd><a href="https://amazon.co.uk/dp/{{ book.ebook_asin }}">{{ book.ebook_asin }}</a></dd>
      {% endif %}
      {% if book.ebook_asin %}
      <dt>Ebook ISBN</dt><dd>{{ book.ebook_isbn }}</dd>
      {% endif %}
    {% endif %}
  </div>

  {% if book.owned_by or book.was_borrowed or book.alienated_date %}
  <div class="col" id="ownership-details">
    {% if book.owned_by_sara %}
      Sara owns
    {% else %}
      I {% if book.owned %}own{% elif book.was_borrowed %}borrowed{% else %}owned{% endif %}
    {% endif %}
    a{% if book.get_edition_format_display().lower()[0] in ['a', 'e', 'i', 'o', 'u'] %}n{% endif %} {{ book.get_edition_format_display().lower() }} edition
    {%- if book.was_borrowed %} from {{ book.borrowed_from }}{% endif -%}
      {%- if book.acquired_date or book.alienated_date %} which I
        {%- if book.acquired_date %}
          acquired on {{ book.acquired_date.strftime("%d %B, %Y") }}
          {%- if book.acquired_date and book.alienated_date %} and {% endif -%}
        {%- endif -%}
        {%- if book.alienated_date %} disposed of on {{ book.alienated_date.strftime("%d %B, %Y") }}{% endif -%}
      {%- endif -%}
      {%- if book.has_ebook_edition -%}
      , and an ebook edition{% if book.ebook_acquired_date %} which I acquired {% if book.acquired_date == book.ebook_acquired_date %} at the same time{% else %} on {{ book.ebook_acquired_date.strftime("%d %B, %Y") }}{% endif %}{% endif %}
    {%- endif %}.
  </div>
  {% endif %}

  {% if book.review %}
  <div class="col">
    <h3>Review</h3>
    {{ book.review | markdown }}
  </div>
  {% endif %}

  <div class="col">
  <h3>Reading History</h3>
  <ul class="list-unstyled">
  {% for entry in book.all_log_entries %}
    <li>{% include "logentries/date_snippet.html" %}
    {% if entry not in book.log_entries.all() %}
    (<a href="{{ entry.book.get_absolute_url() }}">{{ entry.book.get_edition_disambiguator() }} edition</a>)
    {% endif %}
    <li>
  {% else %}
  <li>No reading history</li>
  {% endfor %}
  </ul>
  </div>

  <div class="col">
    {% include "books/update_form_snippet.html" %}
  </div>

  {% if book.editions.all() | count > 0 %}
  <div class="col">
    <h3>Other Editions</h3>
    <ul>
    {% for edition in book.editions.all() %}
    <li>{{ edition | get_hyperlink }} ({{ edition.get_edition_disambiguator() }} edition)</li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}

  {% if book.parent_edition %}
  <div class="col">
    This book is part of {{ book.parent_edition | get_hyperlink }}
  </div>
  {% elif book.subeditions.count() %}
  <div class="col">
  This book is made up of the following books:
  <ul>
  {% for subedition in book.subeditions.all() %}
    <li>{{ subedition | get_hyperlink }}</li>
  {% endfor %}
  </ul>
  </div>
  {% endif %}

</div>
{% endblock content %}
