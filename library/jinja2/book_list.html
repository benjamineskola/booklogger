{% from "macros.html" import filter_list with context %}
{% from "macros/card.html" import book_list with context %}
{% extends "base.html" %}
{% block content %}
  {% if format %}
    <h2 class="ui header">{{ format }}</h2>
  {% endif %}

  <p class="ui top attached segment">
    {% if request.resolver_match.url_name not in ["books_read", "books_read_undated", "series_details", "tag_details", "books_reviewed", "books_unreviewed", "publisher_details"] %}
      {% set qs = '?' + request.GET.urlencode() %}
      Formats: <a href="{{ url(request.resolver_match.view_name) }}{{ qs }}">all</a>
      {% if not format %}
        {%- for n, f  in formats if n in counts and counts[n] > 0 -%}
          , <a href="{{ url(request.resolver_match.view_name, kwargs={"format": f.lower()}) }}{{ qs }}">{{ f | lower }}</a> ({{ counts[n] }})
        {%- endfor -%}
        , <a href="{{ url(request.resolver_match.view_name, kwargs={"format": "physical"}) }}{{ qs }}">physical</a> ({{ counts.get(1) | int + counts.get(2) | int }})
      {% endif %}
      <br>
    {% endif %}

    {{ filter_list('Gender', 'gender', {'male': 'male', 'female': 'female', 'nonbinary': 'nonbinary', 'multiple': 'multiple', 'non-male': 'nonmale', 'groups/organisations': 'organization'}) }}
    <br>
    {{ filter_list('POC', 'poc', {'yes': '1', 'no': '0'}) }}
    <br>
    {{ filter_list('Subject', 'tags', {'fiction': 'fiction', 'non-fiction': 'non-fiction'}) }}
  </p>

  {% if stats %}
    <p class="ui bottom attached segment">
      {{ stats["total"] }} items, {{ stats["owned"] }} owned, {{ stats["read"] }} read.
    </p>
  {% endif %}

  {{ book_list(page_obj) }}
{% endblock content %}
