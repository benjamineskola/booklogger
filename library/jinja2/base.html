{% set pages = [
('All', 'library:books_all'),
('Owned', 'library:books_owned'),
('By Date', 'library:books_owned_by_date'),
('Borrowed', 'library:books_borrowed'),
('Reading', 'library:books_currently_reading'),
('Read', 'library:books_read'),
('To Read', 'library:books_unread'),
('Wishlist', 'library:books_unowned'),
('Authors', 'library:author_list'),
('Series', 'library:series_index'),
('Tags', 'library:tag_cloud'),
('Stats', 'library:stats')
]%}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="{{ static("style.css") }}">
    <title>{% if page_title %}{{ page_title }} — {% endif %}Booklogger</title>
    {% block header %}
    {% endblock %}
  </head>
  <body>
<div class="ui grid">
  <div class="computer only row">
    <div class="column">
      <div class="ui inverted menu">
        <a class="header item" href="{{ url('library:index')  }}">Booklogger</a>
        {% for page in pages %}
        <a class="{% if page[1] == request.resolver_match.view_name %}active {% endif %}computer only item" href="{{url(page[1])}}">{{ page[0] }}</a>
        {% endfor %}
        <div class="right menu">
          <div class="item">
            <form class="ui icon input" action="{{url('library:basic_search')}}">
              <input type="search" placeholder="Search" aria-label="Search" name="query">
              <i class="search link icon"></i>
            </form>
          </div>
          {% if user.is_authenticated %}
            <div class="ui simple dropdown item">
              Admin
              <i class="dropdown icon"></i>
              <div class="simple menu">
                <a class="item" href="{{ url('admin:index') }}">Admin</a>
                <a class="item" href="{{ url('library:author_new') }}">Create Author</a>
                <a class="item" href="{{ url('library:book_new') }}">Create Book</a>
                <a class="item" href="{{ url('library:book_import') }}">Goodreads Import</a>
                <a class="item" href="{{ url('library:bulk_import') }}">Bulk Import</a>
                <a class="item" href="{{ url('library:report') }}">Reports</a>
                {% if request.get_host() == "booklogger.eskola.uk" %}
                <a class="item" href="http://localhost:8000{{ url(request.resolver_match.view_name, kwargs=request.resolver_match.kwargs) }}">Development</a>
                {% else %}
                <a class="item" href="http://booklogger.eskola.uk{{ url(request.resolver_match.view_name, kwargs=request.resolver_match.kwargs) }}">Production</a>
                {% endif %}
              </div> <!-- simple menu -->
            </div> <!-- dropdown -->
          {% else %}
            <a class="item" href="{{ url('admin:login') }}?next={{ request.get_full_path () }}">Log In</a>
          {% endif %}
        </div> <!-- right menu -->
      </div> <!-- menu -->
    </div> <!-- column -->
  </div> <!-- row -->
  <div class="tablet mobile only row">
    <div class="column">
      <div class="ui inverted menu">
        <a class="header item">Booklogger</a>
        <div class="ui simple dropdown item"><i class="bars icon"></i>
          <div class="inverted sidebar menu">
            {% for page in pages %}
              <a class="{% if page[1] == request.resolver_match.view_name %}active {% endif %}computer only item" href="{{url(page[1])}}">{{ page[0] }}</a>
            {% endfor %}
            <div class="item">
              <form class="ui icon input" action="{{url('library:basic_search')}}">
                <input type="search" placeholder="Search" aria-label="Search" name="query">
                <i class="search link icon"></i>
              </form>
            </div>
            {% if user.is_authenticated %}
              <div class="divider"></div>
              <span class="header item">Admin</span>
              <a class="item" href="{{ url('admin:index') }}">Admin</a>
              <a class="item" href="{{ url('library:author_new') }}">Create Author</a>
              <a class="item" href="{{ url('library:book_new') }}">Create Book</a>
              <a class="item" href="{{ url('library:book_import') }}">Goodreads Import</a>
              <a class="item" href="{{ url('library:bulk_import') }}">Bulk Import</a>
              <a class="item" href="{{ url('library:report') }}">Reports</a>
              {% if request.get_host() == "booklogger.eskola.uk" %}
              <a class="item" href="http://localhost:8000{{ url(request.resolver_match.view_name, kwargs=request.resolver_match.kwargs) }}">Development</a>
              {% else %}
              <a class="item" href="http://booklogger.eskola.uk{{ url(request.resolver_match.view_name, kwargs=request.resolver_match.kwargs) }}">Production</a>
              {% endif %}
            {% else %}
              <a class="item" href="{{ url('admin:login') }}?next={{ request.get_full_path () }}">Log In</a>
            {% endif %}
          </div> <!-- simple menu -->
        </div> <!-- dropdown -->
      </div> <!-- menu -->
    </div> <!-- column -->
  </div> <!-- row -->
</div> <!-- grid -->

<div class="ui main container" style="margin-bottom: 2em">
  {% if page_title and request.resolver_match.url_name != 'book_details' %}
    <h1 class="ui header">
    {{ page_title }}
    </h1>
  {% endif %}
  {% block content %}
  {% endblock %}

    {% if page_obj and page_obj.paginator and page_obj.paginator.num_pages > 1 %}
    {% set params = request.GET.copy() %}
    {% set qs = params.urlencode() %}
      <div class="ui center aligned container" style="margin-top: 2em">
      <nav class="ui stackable pagination menu">
          {% if request.resolver_match.kwargs["format"] %}
            {% set new_kwargs= {"format": request.resolver_match.kwargs["format"]} %}
          {% else %}
            {% set new_kwargs = {} %}
          {% endif %}

          {% if page_obj.number > 1 %}
            {% if page_obj.previous_page_number() > 1 %}
              {% set prev_kwargs = dict(new_kwargs, **{"page": page_obj.previous_page_number()}) %}
            {% else %}
              {% set prev_kwargs = new_kwargs%}
            {% endif %}

            <a class="item" href="{{ url(request.resolver_match.view_name, kwargs=prev_kwargs) }}{% if qs %}?{{ qs }}{% endif %}">&laquo;</a>
          {% else %}
            <span class="disabled item">&laquo;</span>
          {% endif %}

          {% for pageno in page_obj.paginator.page_range %}

            {% if page_obj.paginator.num_pages < 10 or pageno == 1 or pageno == page_obj.paginator.num_pages or (pageno > page_obj.number - 3 and pageno < page_obj.number + 3) %}
              {% if pageno > 1 %}
              {% set new_kwargs = dict(new_kwargs, **{"page": pageno}) %}
              {% endif %}
              <a class="item{% if pageno == page_obj.number %} active{% endif %}" href="{{ url(request.resolver_match.view_name, kwargs=new_kwargs) }}{% if qs %}?{{ qs }}{% endif %}">{{pageno}}</a>
            {% elif pageno == page_obj.number - 3 or pageno == page_obj.number + 3 %}
              <span class="disabled item">…</span>
            {% endif %}
          {% endfor %}

          {% if page_obj.number < page_obj.paginator.num_pages %}
            <a class="item" href="{{ url(request.resolver_match.view_name, kwargs=dict(request.resolver_match.kwargs, **{"page": page_obj.next_page_number()})) }}{% if qs %}?{{ qs }}{% endif %}">&raquo;</a>
          {% else %}
            <span class="disabled item">&raquo;</span>
          {% endif %}
    </nav>
    </div>
    {% endif %}
</div>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <script src="{{ static("script.js") }}"></script>
    <script>
      $(document).ready(function() {
        $('.ui.rating').rating();
      });
    </script>
    {% block footer %}
    {% endblock footer %}
  </body>
</html>
