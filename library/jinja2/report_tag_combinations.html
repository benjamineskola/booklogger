{% from "macros.html" import link_amazon, link_goodreads with context %}
{% extends "base.html" %}
{% block content %}
  {% for tag, books in results.items() | sort %}
    <h2 id="{{ tag | replace(" ", "_") }}">
      {{ tag }}
    </h2>
    <ol>
      {% for tags, tagged_books in books | groupby('tags') %}
        <li>
          {{ tag }}
          {%- for i in tags | reject('in', excluded_tags) | reject('eq', tag) -%}
            , <a href="#{{ i  | replace(' ', '_') }}">{{ i }}</a>
          {%- endfor %}
          <ul>
            {% for book in tagged_books %}
              <li>
                <a href="{{ book.get_absolute_url() }}">{{ book.first_author }}, <em>{{ book.display_title }}</em></a>
                <small>(<a href="{{ url('library:book_edit', args=[book.slug]) }}">edit</a>)</small>
              </li>
            {% endfor %}
          </ul>
        </li>
      {% endfor %}
    </ol>
  {% endfor %}

  <h3>Reports</h3>
  <ul>
    {% for i in categories %}
      <li><a href="/report/{{ loop.index }}/">{{ i[0] }}</a></li>
    {% endfor %}
  </ul>
{% endblock %}
