{% from "macros.html" import book_link_with_authors with context %}
{% extends "base.html" %}
{% block content %}
  {% if query %}
    <p>This might be the following books on Goodreads:</p>

    <div class="ui items">
      {% for goodreads_result in goodreads_results %}
        <div class="item">
          <div class="content">
            <a href="https://www.goodreads.com/book/show/{{ goodreads_result["best_book"]["id"]["#text"] }}">{{ goodreads_result["best_book"]["author"]["name"] }}, <em>{{ goodreads_result["best_book"]["title"] }}</em></a>.

            {% if matches[goodreads_result['id']['#text']] %}
              This might already be in the library as {{ book_link_with_authors(matches[goodreads_result['id']['#text']]) }}.
            {% endif %}

            <div class="ui form extra">
              <form action="{{url('library:book_import')}}" method="post">
                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                <input type="hidden" name="query" value="{{ query }}">
                <input type="hidden" name="data" value="{{ goodreads_result | json }}">
                <input class="ui button primary" type="submit" value="Import" />
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="ui form">
    <form action="{{url('library:book_import')}}" method="get">
      <div class="two fields">
        <div class="ui field">
          <input type="text" name="query" placeholder="Search" />
        </div>
        <div class="ui field">
          <input class="ui button primary" type="submit" value="Import" />
        </div>
      </div>
    </form>
  </div>
{% endblock content %}
